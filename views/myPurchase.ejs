<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Minhas Compras</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='/stylesheets/navBar.css'>
    <link rel="stylesheet" href="/stylesheets/myPurchase.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <script src='/javascripts/sideBar.js'></script>
</head>
<body>
    <nav id="nav-container">
        <header id="header"><a class="open-btn" onclick="toggleSidebar()">Tênis Zone</a></header>
        <ul class="nav-links">
            <% if (!cliente) { %>
                <li><a href="/login"><i class="bi bi-person-circle"></i></a></li>
            <% } else { %>
                <li><a href="/carrinho/"><i class="bi bi-cart2"></i></a></li>
                <li><a href="/minhaConta/<%= cliente.clienteID %>"><i class="bi bi-person-circle"></i></a></li>
            <% } %>
        </ul>
    </nav>

    <div class="sidebar" id="sidebar">
        <a href="/home" class="home-button"><i class="bi bi-house"></i></a>
        <button class="close-btn" onclick="toggleSidebar()">x</button>

        <ul class="sidebar-links">
            <% if(!cliente){ %>
                <li><a href="#">Masculino</a></li>
                <li><a href="#">Feminino</a></li>
            <% } else { %>
                <li><a href="#">Masculino</a></li>
                <li><a href="#">Feminino</a></li>
                <li><a href="/minhasCompras">Minhas compras</a></li>
            <% } %>
        </ul>

        <% if (cliente) { %>
            <div class="container-links">
                <li><a href="/logout" class="logout-button"><i class="bi bi-box-arrow-right"></i></a></li>
            </div>
        <% } %>
    </div>

    <main class="my-purchase">
        <h2>Minhas compras</h2>

        <% if (compras.length === 0) { %>
            <p class="empty">Sem compras registradas.</p>
        <% } else { %>
            <% compras.forEach(c => { %>
                <% 
                    // Garante que as imagens virem um array
                    const imagens = Array.isArray(c.Produto.imagens)
                        ? c.Produto.imagens
                        : c.Produto.imagens.split(',');
                %>
                <div class="item">
                    <img src="/images/<%= c.Produto.pasta_imagens %>/<%= imagens[0].trim() %>" alt="<%= c.Produto.nome %>">
                    <div class="item-details">
                        <h3><%= c.Produto.nome %></h3>
                        <p>Preço: R$ <%= Number(c.Produto.valor).toFixed(2).replace(".", ",") %></p>
                        <p>Tamanho: <%= c.tamanho %></p>
                        <p>Quantidade: <%= c.quantidade %></p>
                    </div>
                </div>
            <% }) %>
        <% } %>
    </main>
</body>
</html>
